From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: AlphaKR93 <alphakr93@outlook.com>
Date: Sun, 15 Jan 2023 16:03:01 +0900
Subject: [PATCH] Mining speed tweaks


diff --git a/src/main/java/net/minecraft/world/entity/player/Player.java b/src/main/java/net/minecraft/world/entity/player/Player.java
index bfee4d75736b91503d3ec8bea57754b574d0c6f2..18223e73ba4bceb8fcf7cd3f65151682c6be5b37 100644
--- a/src/main/java/net/minecraft/world/entity/player/Player.java
+++ b/src/main/java/net/minecraft/world/entity/player/Player.java
@@ -185,6 +185,7 @@ public abstract class Player extends LivingEntity {
     // Paper end
     public int sixRowEnderchestSlotCount = -1; // Purpur
     public boolean canPortalInstant = false; // Purpur
+    public float miningSpeedAmplifier = 0; // Andromeda
 
     // CraftBukkit start
     public boolean fauxSleeping;
@@ -871,14 +872,16 @@ public abstract class Player extends LivingEntity {
             f *= f1;
         }
 
-        if (this.isEyeInFluid(FluidTags.WATER) && !EnchantmentHelper.hasAquaAffinity(this)) {
+        if (this.isEyeInFluid(FluidTags.WATER) && !EnchantmentHelper.hasAquaAffinity(this)  && !this.getLevel().andromedaLevelConfiguration().entity.player.mining.disableSpeedReductionWhenSwiming.enabled && (!this.getLevel().andromedaLevelConfiguration().entity.player.mining.disableSpeedReductionWhenSwiming.usePermission || this.getBukkitEntity().hasPermission("andromeda.mining.bypass-swiming-reduction"))) { // Andromeda
             f /= 5.0F;
         }
 
-        if (!this.onGround) {
+        if (!this.onGround && !this.getLevel().andromedaLevelConfiguration().entity.player.mining.disableSpeedReductionWhenFlying.enabled && (!this.getLevel().andromedaLevelConfiguration().entity.player.mining.disableSpeedReductionWhenFlying.usePermission || this.getBukkitEntity().hasPermission("andromeda.mining.bypass-flying-reduction"))) { // Andromeda
             f /= 5.0F;
         }
 
+        f += this.miningSpeedAmplifier; // Andromeda
+
         return f;
     }
 
diff --git a/src/main/java/org/bukkit/craftbukkit/entity/CraftPlayer.java b/src/main/java/org/bukkit/craftbukkit/entity/CraftPlayer.java
index ea78e145787f1d5d7fbcdcb498f286910f213c22..c92e5d5bc62d7d02ded8b53deb141de3ceca51ae 100644
--- a/src/main/java/org/bukkit/craftbukkit/entity/CraftPlayer.java
+++ b/src/main/java/org/bukkit/craftbukkit/entity/CraftPlayer.java
@@ -3167,5 +3167,15 @@ public class CraftPlayer extends CraftHumanEntity implements Player {
     public void setModName(net.kyori.adventure.text.Component component) {
         this.getHandle().connection.send(new ClientboundCustomPayloadPacket(ClientboundCustomPayloadPacket.BRAND, (new FriendlyByteBuf(Unpooled.buffer())).writeUtf(io.papermc.paper.adventure.PaperAdventure.asJsonString(component, java.util.Locale.ROOT))));
     }
+
+    @Override
+    public float getMiningAmplifier() {
+        return this.getHandle().miningSpeedAmplifier;
+    }
+
+    @Override
+    public void setMiningAmplifier(float amplifier) {
+        this.getHandle().miningSpeedAmplifier = amplifier;
+    }
     // Andromeda end
 }
diff --git a/src/main/java/team/earendel/andromeda/configurations/LevelConfigurations.java b/src/main/java/team/earendel/andromeda/configurations/LevelConfigurations.java
index 6a7cdd347e1c1527c855dc0791170e6174cf49b5..b62b37ac95a15f9107154832f1d9010549f150b0 100644
--- a/src/main/java/team/earendel/andromeda/configurations/LevelConfigurations.java
+++ b/src/main/java/team/earendel/andromeda/configurations/LevelConfigurations.java
@@ -32,6 +32,27 @@ public class LevelConfigurations extends ConfigurationPart {
             public boolean checkSpectatorMovedToQuickly = true;
             public boolean giveAdvancementsReward = true;
 
+            public Mining mining;
+            public class Mining extends ConfigurationPart {
+
+                public DisableSpeedReductionWhenFlying disableSpeedReductionWhenFlying;
+                public class DisableSpeedReductionWhenFlying extends ConfigurationPart {
+
+                    public boolean enabled = false;
+                    public boolean usePermission = false;
+
+                }
+
+                public DisableSpeedReductionWhenSwiming disableSpeedReductionWhenSwiming;
+                public class DisableSpeedReductionWhenSwiming extends ConfigurationPart {
+
+                    public boolean enabled = false;
+                    public boolean usePermission = false;
+
+                }
+
+            }
+
         }
 
         public Vehicle vehicle;
