From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: AlphaKR93 <alphakr93@outlook.com>
Date: Sat, 14 Jan 2023 02:18:27 +0900
Subject: [PATCH] Fix SPIGOT-7073


diff --git a/src/main/java/net/minecraft/server/network/ServerGamePacketListenerImpl.java b/src/main/java/net/minecraft/server/network/ServerGamePacketListenerImpl.java
index 5e4d1b23a6e6e7dcbed8d40ccf5355cd3bb1e565..cd76d1562cd7a6b82b0b01201d42b73a7b53d1e3 100644
--- a/src/main/java/net/minecraft/server/network/ServerGamePacketListenerImpl.java
+++ b/src/main/java/net/minecraft/server/network/ServerGamePacketListenerImpl.java
@@ -2725,9 +2725,9 @@ public class ServerGamePacketListenerImpl implements ServerPlayerConnection, Tic
         double d2 = this.player.getZ();
         Location origin = new Location(this.player.level.getWorld(), d0, d1, d2, f2, f1);
 
-        double d3 = player.gameMode.getGameModeForPlayer() == GameType.CREATIVE ? 5.0D : 4.5D;
+        double d3 = player.gameMode.getGameModeForPlayer() == GameType.CREATIVE ? 5.0D : (this.player.level.andromedaLevelConfiguration().spigotBugFix.fixSpigot7073 ? 3.0D : 4.5D); // Andromeda - Fix SPIGOT-7073
         // SPIGOT-5607: Only call interact event if no block or entity is being clicked. Use bukkit ray trace method, because it handles blocks and entities at the same time
-        org.bukkit.util.RayTraceResult result = this.player.level.getWorld().rayTrace(origin, origin.getDirection(), d3, org.bukkit.FluidCollisionMode.NEVER, false, 0.1, entity -> entity != this.player.getBukkitEntity() && this.player.getBukkitEntity().canSee(entity));
+        org.bukkit.util.RayTraceResult result = this.player.level.getWorld().rayTrace(origin, origin.getDirection(), d3, org.bukkit.FluidCollisionMode.NEVER, false, (this.player.level.andromedaLevelConfiguration().spigotBugFix.fixSpigot7073 ? 0 : 0.1), entity -> entity != this.player.getBukkitEntity() && this.player.getBukkitEntity().canSee(entity)); // Andromeda - Fix SPIGOT-7073
 
         if (result == null || this.player.gameMode.getGameModeForPlayer() == GameType.ADVENTURE) { // Paper - call PlayerInteractEvent when left-clicking on a block in adventure mode
             CraftEventFactory.callPlayerInteractEvent(this.player, Action.LEFT_CLICK_AIR, this.player.getInventory().getSelected(), InteractionHand.MAIN_HAND);
diff --git a/src/main/java/team/earendel/andromeda/configurations/LevelConfigurations.java b/src/main/java/team/earendel/andromeda/configurations/LevelConfigurations.java
index 74db630dead628eae675dfead4beb97169f5e8f0..f4ab5913d335e090e67a97fcf01abcd842d2afd7 100644
--- a/src/main/java/team/earendel/andromeda/configurations/LevelConfigurations.java
+++ b/src/main/java/team/earendel/andromeda/configurations/LevelConfigurations.java
@@ -199,4 +199,11 @@ public class LevelConfigurations extends ConfigurationPart {
 
     }
 
+    public SpigotBugFix spigotBugFix;
+    public class SpigotBugFix extends ConfigurationPart {
+
+        public boolean fixSpigot7073 = true;
+
+    }
+
 }
